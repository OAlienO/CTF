#!/usr/bin/env python3
from pwn import *
import intervals
import math
import json

e = 0x10001
c = 32028315366572316530941187471534975579021238700122793819215559206747120150118490538115208229905399038122261293920013020124257186389163654867911967899754432511568776857320594304655042217535057811315461534790485879395513727264354857833013662037825295017832478478693519684813603327210332854320793948700855663229

r = remote('likeason-01.pwn.beer', 31337)

def count(x):
    return bin(x).count('1') & 1

def oracle(c, x = 1):
    r.sendline(f'{c} {x}')
    return int(r.recvline())

def get_n(lb = c + 1, ub = c + 1):
    while True:
        result = oracle(ub, e)
        if result != count(ub):
            break
        ub *= 2

    confidence = 3
    while ub - lb < 1000:
        print(f'upper bound = {ub}')
        print(f'lower bound = {lb}')
        m = (ub + lb) // 2
        for i in range(m - 2 ** confidence, m + 2 ** confidence):
            result = oracle(i, e)
            if result != count(i):
                ub = i
                break
        else:
            lb = m - 2 ** confidence

    return lb, ub

#lb = 105494664357066481298273138238876092390330742404078324408026962658968380291303857669383660190770657673465977042032164073836191436822877521608596568122500853908959638684718610332316825906188233823855819550632166881722171330162713932165700003935670468125777337326977215421773864352824079828871058941531074845955
#ub = 105494664357066481298273138238876092390330742404078324408026962658968380291303857669383660190770657673465977042032164073836191436822877521608596568122500853908959638684718610332316825906188233823855819550632166881722171330162713932165700003935670468125777337326977215421773864352936563199582432598944025575733
#get_n(lb, ub)

n = 105494664357066481298273138238876092390330742404078324408026962658968380291303857669383660190770657673465977042032164073836191436822877521608596568122500853908959638684718610332316825906188233823855819550632166881722171330162713932165700003935670468125777337326977215421773864352895234724039118099959574928191
